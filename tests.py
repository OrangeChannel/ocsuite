import unittest
import ocsuite

chapters = {  # inclusive
    '01|Part A':      (0, 3770),
    '01|Title Card':  (3771, 3860),
    '01|Part B':      (3861, 20883),
    '01|Middle Card': (20884, 21003),
    '01|Part C':      (21004, 30041),
    '01|OP':          (30042, 32200),
    '01|Part D':      (32201, 33685),
    '01|Preview':     (33686, 34045),

    '02|Part A':      (34070, 35747),
    '02|OP':          (35748, 37906),
    '02|Part B':      (37907, 51308),
    '02|Middle Card': (51309, 51428),
    '02|Part C':      (51429, 65047),
    '02|ED':          (65048, 67180),
    '02|Part D':      (67181, 67732),
    '02|Preview':     (67733, 68092),

    '03|Part A':      (68117, 70058),
    '03|OP':          (70059, 72217),
    '03|Part B':      (72218, 81784),
    '03|Middle Card': (81785, 81904),
    '03|Part C':      (81905, 98590),
    '03|ED':          (98591, 100725),
    '03|Part D':      (100726, 101779),
    '03|Preview':     (101780, 102139),

    '04|Part A':      (102164, 104729),
    '04|OP':          (104730, 106886),
    '04|Part B':      (106887, 120887),
    '04|Middle Card': (120888, 121007),
    '04|Part C':      (121008, 133139),
    '04|ED':          (133140, 135272),
    '04|Part D':      (135273, 135824),
    '04|Preview':     (135825, 136184),

    '05|Part A':      (136209, 137048),
    '05|OP':          (137049, 139205),
    '05|Part B':      (139206, 151266),
    '05|Middle Card': (151267, 151386),
    '05|Part C':      (151387, 167474),
    '05|ED':          (167475, 169607),
    '05|Part D':      (169608, 169871),
    '05|Preview':     (169872, 170231),

    '06|Part A':      (170256, 171957),
    '06|OP':          (171958, 174116),
    '06|Part B':      (174117, 187231),
    '06|Middle Card': (187232, 187351),
    '06|Part C':      (187352, 200512),
    '06|ED':          (200513, 202647),
    '06|Part D':      (202648, 203917),
    '06|Preview':     (203918, 204277),

    '07|Part A':      (204302, 205405),
    '07|OP':          (205406, 207562),
    '07|Part B':      (207563, 225999),
    '07|Middle Card': (226000, 226119),
    '07|Part C':      (226120, 235519),
    '07|ED':          (235520, 237652),
    '07|Part D':      (237653, 237964),
    '07|Preview':     (237965, 238324),

    '08|Part A':      (238349, 242281),
    '08|OP':          (242282, 244438),
    '08|Part B':      (244439, 254892),
    '08|Middle Card': (254893, 255012),
    '08|Part C':      (255013, 268797),
    '08|ED':          (268798, 270932),
    '08|Part D':      (270933, 272010),
    '08|Preview':     (272011, 272370),

    '09|Part A':      (272395, 273114),
    '09|OP':          (273115, 275272),
    '09|Part B':      (275273, 283975),
    '09|Middle Card': (283976, 284095),
    '09|Part C':      (284096, 303395),
    '09|ED':          (303396, 305528),
    '09|Part D':      (305529, 306056),
    '09|Preview':     (306057, 306416),

    '10|Part A':      (306443, 307232),
    '10|OP':          (307233, 309389),
    '10|Part B':      (309390, 322888),
    '10|Middle Card': (322889, 323008),
    '10|Part C':      (323009, 336601),
    '10|ED':          (336602, 338736),
    '10|Part D':      (338737, 340102),
    '10|Preview':     (340103, 340462),

    '11|Part A':      (340487, 340774),
    '11|OP':          (340775, 342932),
    '11|Part B':      (342933, 359378),
    '11|Middle Card': (359379, 359498),
    '11|Part C':      (359499, 369568),
    '11|ED':          (369569, 371702),
    '11|Part D':      (371703, 374147),
    '11|Preview':     (374148, 374507),

    '12|Part A':      (374545, 408744),

    'OVA|OP':                                   (408769, 410926),
    'OVA|Part 1: You Never Let Us Down':        (410927, 425142),
    'OVA|Card 1':                               (425143, 425262),
    'OVA|Part 2: Always Growing Closer':        (425263, 426565),
    'OVA|Card 2':                               (426566, 426709),
    'OVA|Part 3: Let\'s Change You Into This!': (426710, 435939),
    'OVA|Card 3':                               (435940, 436059),
    'OVA|Part 4: I\'m Your Big Sister':         (436060, 439242),
    'OVA|ED':                                   (439243, 441376)
}

repeated_chapters = ['OP', 'ED']
remuxed_bdmv = '/path/to/remuxed.mkv'


class OCsuiteTests(unittest.TestCase):

    def test_compress(self):
        self.assertEqual(ocsuite._compress([1, 5, 11, 13], [3, 8, 12, 15]), ([0, 3, 7, 9], [2, 6, 8, 11]))
        self.assertEqual(ocsuite._compress([1, 4, 8, 11, 14, 18, 24, 33, 36], [2, 7, 9, 13, 17, 20, 30, 35, 41]),
                         ([0, 2, 6, 8, 11, 15, 18, 25, 28], [1, 5, 7, 10, 14, 17, 24, 27, 33]))
        self.assertEqual(ocsuite._compress([5], [9]), ([0], [4]))

    def test_combine(self):
        self.assertEqual(ocsuite._combine([0, 5, 9, 12, 17, 19, 25], [2, 8, 11, 14, 18, 20, 27]),
                         ([0, 5, 17, 25], [2, 14, 20, 27]))
        self.assertEqual(
            ocsuite._combine([1, 3, 7, 10, 21, 45, 60, 72, 74, 82], [2, 5, 9, 20, 40, 50, 70, 73, 79, 90]),
            ([1, 7, 45, 60, 72, 82], [5, 40, 50, 70, 79, 90]))
        self.assertEqual(ocsuite._combine([5], [9]), ([5], [9]))

    # TODO: add testing for main function


if __name__ == '__main__':
    unittest.main()
